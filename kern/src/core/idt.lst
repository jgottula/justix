     1                                  %include 'common/header.inc'
     2                              <1> # 1 "src/common/header.h"
     3                              <1> # 1 "<command-line>"
     4                              <1> # 1 "src/common/header.h"
     5                              <1> 
     6                              <1> 
     7                              <1>  cpu 586
     8                              <1>  bits 32
     9                              <1> 
    10                              <1> %include 'common/macros.inc'
    11                              <2> # 1 "src/common/macros.h"
    12                              <2> # 1 "<command-line>"
    13                              <2> # 1 "src/common/macros.h"
    14                              <2> 
    15                              <2> 
    16                              <2> 
    17                              <2> 
    18                              <2> 
    19                              <2> 
    20                              <2> 
    21                              <2> %macro frame 0-1
    22                              <2>  push ebp
    23                              <2>  mov ebp,esp
    24                              <2> %if %0 == 1
    25                              <2>  sub esp,%1
    26                              <2> %endif
    27                              <2> %endm
    28                              <2> 
    29                              <2> %macro unframe 0
    30                              <2>  mov esp,ebp
    31                              <2>  pop ebp
    32                              <2> %endm
    33                                  %include 'core/idt.inc'
    34                              <1> # 1 "src/core/idt.h"
    35                              <1> # 1 "<command-line>"
    36                              <1> # 1 "src/core/idt.h"
    37                                  	
    38                                  	extern trap_gpf
    39                                  	
    40                                  	section .text
    41                                  	
    42                                  	global idt_setup:function
    43                                  idt_setup:
    44 00000000 B80D000000              	mov eax,0x0d
    45 00000005 BB[00000000]            	mov ebx,trap_gpf
    46 0000000A E808000000              	call idt_setup_trap
    47                                  	
    48 0000000F 0F011D[00080000]        	lidt [idt_table.info]
    49                                  	
    50 00000016 C3                      	ret
    51                                  	
    52                                  idt_setup_trap:
    53 00000017 66891CC5[00000000]      	mov word [idt_table+eax*8],bx
    54 0000001F 66C704C5[02000000]-     	mov word [idt_table+eax*8+2],0x10
    55 00000027 1000               
    56 00000029 C604C5[04000000]00      	mov byte [idt_table+eax*8+4],0x00
    57 00000031 C604C5[05000000]8F      	mov byte [idt_table+eax*8+5],0b10001111
    58 00000039 C1EB10                  	shr ebx,16
    59 0000003C 66891CC5[06000000]      	mov word [idt_table+eax*8+6],bx
    60                                  	
    61 00000044 C3                      	ret
    62                                  	
    63                                  	
    64                                  	section .data
    65                                  	
    66                                  	global idt_table:data
    67                                  idt_table:
    68 00000000 0000000000000000-       	times 0x100 dq 0
    69 00000000 <rept>             
    70                                  .info:
    71 00000800 FF07                    	dw ((.info-idt_table)-1)
    72 00000802 [00000000]              	dd idt_table
