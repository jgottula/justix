# justix: scripts
# (c) 2013 Justin Gottula
# The source code of this project is distributed under the terms of the
# simplified BSD license. See the LICENSE file for details.

CC:=ccache gcc
CFLAGS:=-std=gnu11 -O0 -ggdb -Wall -Wextra -Wno-unused-parameter -Wno-unused-function -include stdbool.h -include stdint.h
LDFLAGS:=

DEFINES:=-D_GNU_SOURCE
INCLUDE:=../../jgfs/src/

SETUP_LIBS:=
INSTALL_LIBS:=-lbsd -ludev

COMMON_OBJS=src/common.o


.PHONY: all clean setup install

# default rule
all: setup install

setup:   bin/setup
install: bin/install

clean:
	rm -rf $(wildcard bin/*) $(wildcard src/*.o) $(wildcard src/*.dep)


bin/setup: src/setup.o $(COMMON_OBJS)
	$(CC) $(CFLAGS) $(SETUP_LIBS) -o $@ $^
bin/install: src/install.o $(COMMON_OBJS)
	$(CC) $(CFLAGS) $(INSTALL_LIBS) -o $@ $^


%.o: %.c Makefile
	$(CC) $(CFLAGS) $(DEFINES) -o $@ -Isrc -MP -MMD -MF $(<D)/$(patsubst %.c,%.dep,$(<F)) -c $<


# concatenate gcc's autogenerated dependencies
-include src/*.dep
