# jgsys
# (c) 2013 Justin Gottula
# The source code of this project is distributed under the terms of the
# simplified BSD license. See the LICENSE file for details.

CC:=ccache gcc
CFLAGS:=-std=gnu11 -O0 -ggdb -Wall -Wextra -Wno-unused-parameter -Wno-unused-function -include stdbool.h -include stdint.h
LDFLAGS:=
	
DEFINES:=-D_GNU_SOURCE
LIBS:=-lbsd

SETUP_BIN:=setup
INSTALL_BIN:=install
TEST_BIN:=test
BINS:=$(SETUP_BIN) $(INSTALL_BIN) $(TEST_BIN)

COMMON_OBJS=src/common.o


.PHONY: all clean

# default rule
all: $(BINS)

clean:
	rm -rf $(BINS) $(wildcard src/*.o) $(wildcard src/*.dep)


$(SETUP_BIN): $(COMMON_OBJS) src/setup.o
	$(CC) $(CFLAGS) $(LIBS) -o $@ $^
$(INSTALL_BIN): $(COMMON_OBJS) src/install.o
	$(CC) $(CFLAGS) $(LIBS) -o $@ $^
$(TEST_BIN): $(COMMON_OBJS) src/test.o
	$(CC) $(CFLAGS) $(LIBS) -o $@ $^


%.o: %.c Makefile
	$(CC) $(CFLAGS) $(DEFINES) -o $@ -Isrc -MP -MMD -MF $(<D)/$(patsubst %.c,%.dep,$(<F)) -c $<


# concatenate gcc's autogenerated dependencies
-include src/*.dep
