# justix
# (c) 2013 Justin Gottula
# The source code of this project is distributed under the terms of the
# simplified BSD license. See the LICENSE file for details.


CC:=ccache gcc
CFLAGS:=-std=gnu11 -O0 -ggdb -Wall -Wextra -Wno-unused-parameter -Wno-unused-function -include stdbool.h -include stdint.h
LDFLAGS:=

DEFINES:=-D_GNU_SOURCE
INCLUDE:=../../jgfs/src/

SETUP_BIN:=../test/setup
INSTALL_BIN:=../test/install
BINS:=$(SETUP_BIN) $(INSTALL_BIN)

SETUP_LIBS:=
INSTALL_LIBS:=-lbsd -ludev

COMMON_OBJS=common.o


.PHONY: all clean setup install

# default rule
all: setup install

setup:   $(SETUP_BIN)
install: $(INSTALL_BIN)

clean:
	rm -rf $(BINS) $(wildcard *.o) $(wildcard *.dep)


$(SETUP_BIN): setup.o $(COMMON_OBJS)
	$(CC) $(CFLAGS) $(SETUP_LIBS) -o $@ $^
$(INSTALL_BIN): install.o $(COMMON_OBJS)
	$(CC) $(CFLAGS) $(INSTALL_LIBS) -o $@ $^


%.o: %.c Makefile
	$(CC) $(CFLAGS) $(DEFINES) -o $@ -Isrc -MP -MMD -MF $(<D)/$(patsubst %.c,%.dep,$(<F)) -c $<


# concatenate gcc's autogenerated dependencies
-include *.dep
