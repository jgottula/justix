# jgsys
# (c) 2013 Justin Gottula
# The source code of this project is distributed under the terms of the
# simplified BSD license. See the LICENSE file for details.

MAKEFLAGS+=-j16

AS:=nasm
ASFLAGS:=-fbin -MP -Ox -Wall


.PHONY: all clean boot kern

# default rule
all: boot kern

boot: bin/boot.386
kern: bin/kern.386

clean:
	rm -rf bin/* src/*/*.dep


# generic binary rule
bin/%.386: Makefile
	$(AS) $(ASFLAGS) -o $@ -isrc/$*/ -lbin/$*.lst -MD src/$*/$*.dep src/$*/$*.s


# include nasm's autogenerated dependencies
-include src/*/*.dep
